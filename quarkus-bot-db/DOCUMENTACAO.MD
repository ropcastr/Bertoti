# DocumentaÃ§Ã£o da AplicaÃ§Ã£o **Quarkus AI Database Assistant**

> ğŸ’¡ Um assistente de banco de dados com IA integrado ao SQLite, construÃ­do em **Java + Quarkus + Ollama**.  
> Permite criar, consultar e gerenciar bancos de dados usando **linguagem natural**.

---

## ğŸ“š SumÃ¡rio

1. [VisÃ£o Geral](#visÃ£o-geral)  
2. [Estrutura do Projeto](#estrutura-do-projeto)  
3. [PrÃ©-requisitos e ConfiguraÃ§Ã£o](#prÃ©-requisitos-e-configuraÃ§Ã£o)  
4. [Componentes Principais](#componentes-principais)  
   - [Backend (Java/Quarkus)](#1-backend-javaquarkus)  
   - [Frontend (HTML/CSS/JavaScript)](#2-frontend-htmlcssjavascript)  
5. [Como a AplicaÃ§Ã£o Funciona (Fluxo de Uso)](#como-a-aplicaÃ§Ã£o-funciona-fluxo-de-uso)  
6. [Guia RÃ¡pido de Uso](#guia-rÃ¡pido-de-uso)  
7. [ManutenÃ§Ã£o e ExpansÃ£o](#manutenÃ§Ã£o-e-expansÃ£o)  
8. [Problemas Comuns (Troubleshooting)](#problemas-comuns-troubleshooting)  
9. [Fluxo Geral da AplicaÃ§Ã£o](#fluxo-geral-da-aplicaÃ§Ã£o)  
10. [LicenÃ§a e ContribuiÃ§Ã£o](#licenÃ§a-e-contribuiÃ§Ã£o)

---

## ğŸ§  VisÃ£o Geral

Esta aplicaÃ§Ã£o Ã© um **assistente de banco de dados com inteligÃªncia artificial**, projetado para ajudar usuÃ¡rios â€” mesmo iniciantes â€” a interagir com bancos de dados **SQLite** usando linguagem natural.

VocÃª pode digitar frases como:

> â€œCrie um banco de dados de clientes com uma tabela `pessoas` (id, nome, idade)â€  
> ou  
> â€œListe todos os produtos cadastradosâ€.

A IA (chamada **Tenebra**) traduz suas solicitaÃ§Ãµes em comandos SQL, executa-os e mostra os resultados, tudo em uma interface de chat amigÃ¡vel.

A arquitetura combina:
- âš™ï¸ **Quarkus** â€“ backend leve e performÃ¡tico.  
- ğŸ§© **LangChain4j + Ollama** â€“ integraÃ§Ã£o com modelo de linguagem (LLM).  
- ğŸ’» **HTML + CSS + JS** â€“ frontend simples e intuitivo.  
- ğŸª¶ **CommonMark** â€“ renderiza a documentaÃ§Ã£o Markdown da aplicaÃ§Ã£o (novo).

---

## ğŸ—‚ï¸ Estrutura do Projeto

```
.
â”œâ”€â”€ pom.xml                   # ConfiguraÃ§Ã£o do Maven e dependÃªncias.
â”œâ”€â”€ DOCUMENTACAO.MD           # Arquivo principal de documentaÃ§Ã£o em Markdown.
â”œâ”€â”€ src
â”‚   â””â”€â”€ main
â”‚       â”œâ”€â”€ java
â”‚       â”‚   â””â”€â”€ br
â”‚       â”‚       â””â”€â”€ fatec
â”‚       â”‚           â”œâ”€â”€ AIService.java          # Interface da IA.
â”‚       â”‚           â”œâ”€â”€ BrowserLauncher.java    # Abre o navegador na inicializaÃ§Ã£o.
â”‚       â”‚           â”œâ”€â”€ ChatResource.java       # Endpoint principal do chat.
â”‚       â”‚           â”œâ”€â”€ DatabaseResource.java   # Endpoint para consultas SQL diretas.
â”‚       â”‚           â”œâ”€â”€ DocsResource.java       # Servidor de documentaÃ§Ã£o Markdown (/docs).
â”‚       â”‚           â””â”€â”€ TestResource.java       # Endpoint de teste.
â”‚       â””â”€â”€ resources
â”‚           â”œâ”€â”€ application.properties          # ConfiguraÃ§Ãµes da aplicaÃ§Ã£o.
â”‚           â””â”€â”€ META-INF
â”‚               â””â”€â”€ resources
â”‚                   â”œâ”€â”€ index.html              # Interface de chat (frontend).
â”‚                   â””â”€â”€ DOCUMENTACAO.MD         # CÃ³pia servida pelo DocsResource (recomendado).
```

---

## âš™ï¸ PrÃ©-requisitos e ConfiguraÃ§Ã£o

Antes de rodar o projeto, instale os seguintes componentes:

### ğŸ”§ Requisitos

- **Java 21+**
- **Maven 3.9+**
- **Ollama** instalado e rodando localmente (veja https://ollama.com)
- ConexÃ£o de internet (apenas para baixar dependÃªncias e fontes externas, se necessÃ¡rio)

### ğŸ§© Baixe o modelo de IA

```bash
ollama pull qwen3:8b
```

### â–¶ï¸ Como executar o projeto (passo a passo)

1. Clone o repositÃ³rio:
   ```bash
   git clone https://github.com/usuario/quarkus-bot-db.git
   cd quarkus-bot-db
   ```

2. Copie a documentaÃ§Ã£o para os recursos estÃ¡ticos (recomendado para produÃ§Ã£o):
   ```bash
   mkdir -p src/main/resources/META-INF/resources
   cp DOCUMENTACAO.MD src/main/resources/META-INF/resources/
   ```

3. Compile o projeto:
   ```bash
   mvn clean package
   ```

4. Execute o Ollama (em outro terminal):
   ```bash
   ollama run qwen3:8b
   ```

5. Inicie a aplicaÃ§Ã£o Quarkus:
   ```bash
   java -jar target/quarkus-bot-db-1.0.0-SNAPSHOT-runner.jar
   ```

6. O navegador serÃ¡ aberto automaticamente em:  
   ğŸ‘‰ http://localhost:8080

---

## ğŸ§© Componentes Principais

### 1. Backend (Java/Quarkus)

#### ğŸ§± `pom.xml`

Gerencia dependÃªncias e build. AlÃ©m das dependÃªncias base jÃ¡ existentes, foi adicionada a dependÃªncia **CommonMark** para renderizar Markdown em HTML:

```xml
<dependency>
    <groupId>org.commonmark</groupId>
    <artifactId>commonmark</artifactId>
    <version>0.22.0</version>
</dependency>
```

**Importante:** ApÃ³s editar o `pom.xml`, execute `mvn clean package` para baixar as dependÃªncias.

---

#### âš™ï¸ `application.properties`

Principais parÃ¢metros (exemplo):

```properties
quarkus.langchain4j.ollama.chat-model.model-id=qwen3:8b
quarkus.langchain4j.ollama.timeout=120s
quarkus.http.static-resources.enable=true
quarkus.http.static-resources.paths=/
```

- `model-id` â†’ Define o modelo da IA.  
- `timeout` â†’ Tempo mÃ¡ximo de resposta da IA.  
- `static-resources` â†’ Habilita o frontend (`index.html`) e o acesso a arquivos estÃ¡ticos.

---

#### ğŸ§  `AIService.java`

Interface que define a comunicaÃ§Ã£o com a IA. Exemplo de responsabilidades:
- Definir o prompt do sistema com `@SystemMessage` (personalidade, regras e seguranÃ§a).  
- Enviar a conversa/contexto ao modelo via LangChain4j.  
- Receber a resposta textual do modelo.

**Assinatura tÃ­pica:**
```java
String input(String input);
```

---

#### ğŸ’¬ `ChatResource.java` (Endpoint `/chat`)

Ponto central da aplicaÃ§Ã£o. Funcionalidades resumidas:
- Recebe POST com mensagem do usuÃ¡rio e `sessionId`.  
- MantÃ©m histÃ³rico por `sessionId`.  
- Detecta nome de banco (`detectaNomeBanco`) por regex.  
- Envia prompt/contexto para `AIService`.  
- Extrai blocos SQL da resposta (`extrairBlocosSQL`).  
- Executa SQL no banco usando JDBC (`executarComandosSQL`).  
- Retorna resposta formatada ao frontend.

**MÃ©todos auxiliares (descriÃ§Ã£o):**

- `detectaNomeBanco(String msg)`: identifica expressÃµes do tipo "crie o banco X" ou "no banco X".  
- `extrairBlocosSQL(String texto)`: encontra trechos entre ```sql ... ``` e retorna lista de comandos.  
- `executarComandosSQL(String db, List<String> comandos)`: abre conexÃ£o JDBC com `db`.db e executa statements; retorna logs e resultados.  
- `formatarResposta(...)`: compÃµe o HTML/texto final combinado com o texto da IA e o resultado das consultas.

---

#### ğŸ—ƒï¸ `DatabaseResource.java` (Endpoint `/db/query`)

Fornece execuÃ§Ã£o direta de consultas SQL com proteÃ§Ã£o. Aceita apenas `SELECT` por seguranÃ§a.

Exemplo de uso (HTTP POST JSON):
```json
{ "dbName": "escola", "sql": "SELECT * FROM alunos;" }
```

Resposta: JSON com colunas e linhas ou mensagem de erro.

---

#### ğŸ§¾ `DocsResource.java` (Novo endpoint `/docs`)

Classe criada para servir a documentaÃ§Ã£o Markdown renderizada como HTML. Local: `br.fatec.DocsResource`.

Exemplo de implementaÃ§Ã£o (resumido):

```java
package br.fatec;

import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;

import java.io.IOException;
import java.nio.file.Files;
import org.commonmark.node.*;
import org.commonmark.parser.Parser;
import org.commonmark.renderer.html.HtmlRenderer;

@Path("/docs")
public class DocsResource {

    @GET
    @Produces(MediaType.TEXT_HTML)
    public String showDocumentation() throws IOException {
        java.nio.file.Path docPath = java.nio.file.Path.of("DOCUMENTACAO.MD");
        String markdown = Files.readString(docPath);

        Parser parser = Parser.builder().build();
        Node document = parser.parse(markdown);
        HtmlRenderer renderer = HtmlRenderer.builder().build();
        String htmlContent = renderer.render(document);

        return "<!DOCTYPE html>... (HTML wrapper com github-markdown.css) " + htmlContent;
    }
}
```

**ObservaÃ§Ãµes e boas prÃ¡ticas:**
- Durante desenvolvimento, `Path.of("DOCUMENTACAO.MD")` lÃª o arquivo na raiz do projeto.  
- Para empacotar em jar/uber-jar, prefira colocar `DOCUMENTACAO.MD` em `src/main/resources/META-INF/resources/` e ler via `getResourceAsStream` ou servir diretamente como recurso estÃ¡tico.
- Assegure que o arquivo esteja codificado em UTF-8.

---

#### ğŸŒ `BrowserLauncher.java`

Classe utilitÃ¡ria que abre automaticamente o navegador no `StartupEvent` para `http://localhost:8080` quando em modo desenvolvimento/execuÃ§Ã£o.

---

#### ğŸ” `TestResource.java`

Endpoint simples `/test` para verificar disponibilidade do serviÃ§o. Exemplo:

```
GET /test  -> "OlÃ¡! Este Ã© um endpoint de teste."
```

---

### 2. Frontend (HTML/CSS/JavaScript)

#### ğŸ“„ `index.html`

PÃ¡gina Ãºnica que implementa a interface do chat. Destaques:
- Layout responsivo e limpo (CSS + Font Awesome).  
- `localStorage` para guardar `sessionId`.  
- `fetch` para `/chat`, `/chat/welcome`, `/chat/model`.  
- Atalhos (Ctrl+Enter) e botÃµes de prompts prontos.  
- ExibiÃ§Ã£o de mensagens (usuÃ¡rio vs IA) com estilos separados.

**RodapÃ© atualizado (link para docs):**

```html
<footer class="footer">
    Powered by AI âœ¨ 
    <span id="model-info" style="color:#888;font-size:0.95em;"></span>
    <br>
    <a href="/docs" target="_blank" style="color:#0077cc;text-decoration:none;font-weight:500;">
        ğŸ“˜ Ver DocumentaÃ§Ã£o
    </a>
</footer>
```

---

## ğŸ” Como a AplicaÃ§Ã£o Funciona (Fluxo de Uso)

1. O usuÃ¡rio inicia a aplicaÃ§Ã£o; `BrowserLauncher` abre o navegador.  
2. O frontend solicita a mensagem de boas-vindas ao backend (`/chat/welcome`).  
3. O usuÃ¡rio envia comandos via `/chat`.  
4. O backend processa, consulta a IA (Ollama), executa SQL no SQLite e retorna o resultado.  
5. O usuÃ¡rio vÃª a resposta no chat.  
6. Para visualizar a documentaÃ§Ã£o, clica em â€œğŸ“˜ Ver DocumentaÃ§Ã£oâ€, que abre `/docs` em nova aba.

---

## âš¡ Guia RÃ¡pido de Uso

| AÃ§Ã£o | Exemplo de comando | Resultado esperado |
|------|--------------------|--------------------|
| Criar banco e tabela | `Crie o banco vendas com tabela produtos (id, nome, preco)` | Banco e tabela criados |
| Inserir dados | `Adicione produtos: (1, Caneta, 2.50)` | Dados inseridos |
| Consultar | `Liste todos os produtos` | Tabela de resultados |
| Otimizar query | `Otimizar essa query SQL: SELECT * FROM vendas WHERE preco > 10;` | Query reescrita pela IA |
| Abrir documentaÃ§Ã£o | Clique em â€œğŸ“˜ Ver DocumentaÃ§Ã£oâ€ | Exibe documentaÃ§Ã£o formatada |

---

## ğŸ§© ManutenÃ§Ã£o e ExpansÃ£o

- Trocar modelo da IA: alterar `quarkus.langchain4j.ollama.chat-model.model-id` em `application.properties`.  
- Aumentar timeout: `quarkus.langchain4j.ollama.timeout=180s` se necessÃ¡rio.  
- Suportar outro SGBD: substituir driver JDBC no `pom.xml` e adaptar conexÃµes/URL.  
- Personalizar prompt do sistema: editar `@SystemMessage` em `AIService.java`.

---

## ğŸ§° Problemas Comuns (Troubleshooting)

| Problema | Causa provÃ¡vel | SoluÃ§Ã£o |
|-----------|----------------|----------|
| **/docs exibe erro "nÃ£o encontrado"** | `DOCUMENTACAO.MD` nÃ£o estÃ¡ na pasta correta | Copie para `src/main/resources/META-INF/resources/` ou ajuste caminho em `DocsResource` |
| **No candidates found for Path.of(...)** | Import conflitado (`jakarta.ws.rs.Path` vs `java.nio.file.Path`) | Use `java.nio.file.Path.of(...)` completamente qualificado ou importe corretamente |
| **"Erro ao conectar com a IA"** | Ollama nÃ£o estÃ¡ rodando | Execute `ollama run qwen3:8b` |
| **"Database locked"** | Arquivo `.db` aberto em outro processo | Feche o arquivo ou reinicie a aplicaÃ§Ã£o |
| **"Timeout da IA"** | Modelo demorando para responder | Aumente timeout em `application.properties` |
| **"PermissÃ£o negada"** | Sem acesso de gravaÃ§Ã£o no diretÃ³rio | Execute com permissÃµes adequadas ou mude local de DB |

---

## ğŸ§­ Fluxo Geral da AplicaÃ§Ã£o

```mermaid
flowchart LR
    A[UsuÃ¡rio] --> B[index.html]
    B --> C[/chat endpoint]
    C --> D[AIService (Ollama)]
    D --> E[SQLite Database]
    E --> C
    C --> B
    B --> F[/docs endpoint]
    F --> G[DocsResource + CommonMark]
```

---

## ğŸªª LicenÃ§a e ContribuiÃ§Ã£o

Este projeto Ã© distribuÃ­do sob a licenÃ§a **MIT**.  
Sinta-se livre para usar, modificar e contribuir! ğŸš€

Para contribuir:
1. FaÃ§a um *fork* do repositÃ³rio.  
2. Crie uma *branch* (`feature/nome-da-feature`).  
3. Envie um *pull request* com suas melhorias.

---

### Notas finais

- Se desejar, posso tambÃ©m:  
  - Gerar um arquivo HTML separado com a documentaÃ§Ã£o jÃ¡ renderizada;  
  - Criar um pequeno script de deploy para copiar o `DOCUMENTACAO.MD` para `src/main/resources/...`;  
  - Atualizar automaticamente o `pom.xml` (inserir a dependÃªncia CommonMark) e enviar o diff.

